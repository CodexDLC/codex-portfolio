/* BENTO CORE SYSTEM */

/* =========================================
   1. GRID SYSTEM (SIZE MATRIX)
   ========================================= */

.island-grid {
    display: grid;
    /* FIX: Changed width to auto so margins work correctly */
    width: auto;
    /* FIX: Changed height: 100% to flex-grow to avoid overflow with header */
    flex-grow: 1;
    min-height: 0; /* Important for nested flex scroll/overflow */

    grid-auto-flow: dense;
    /* RESTORED: Gap 10px (Standard) */
    gap: 10px;

    /* RESTORED: 50px total side spacing (40px margin + 10px padding) */
    margin: 0 40px;
    padding: 10px;

    box-sizing: border-box;

    /* FIX: Island Border & Hover Effects */
    border: 1px solid transparent; /* Invisible border by default */
    border-radius: 24px; /* Rounded corners for the island */
    transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
}

/* --- THEME HOVER EFFECTS (Parent driven) --- */

/* Gold */
.theme-gold .island-grid:hover {
    border-color: rgba(212, 175, 55, 0.2);
    box-shadow: 0 0 50px rgba(212, 175, 55, 0.03);
    background: rgba(212, 175, 55, 0.01);
}

/* Blue */
.theme-blue .island-grid:hover {
    border-color: rgba(48, 105, 152, 0.2);
    box-shadow: 0 0 50px rgba(48, 105, 152, 0.03);
    background: rgba(48, 105, 152, 0.01);
}

/* Green (R&D) */
.theme-green .island-grid:hover,
.theme-rnd .island-grid:hover {
    border-color: rgba(39, 201, 63, 0.2);
    box-shadow: 0 0 50px rgba(39, 201, 63, 0.03);
    background: rgba(39, 201, 63, 0.01);
}

/* Purple (Proto) */
.theme-purple .island-grid:hover,
.theme-proto .island-grid:hover {
    border-color: rgba(198, 120, 221, 0.2);
    box-shadow: 0 0 50px rgba(198, 120, 221, 0.03);
    background: rgba(198, 120, 221, 0.01);
}

/* Ghost (Config) */
.theme-ghost .island-grid:hover,
.theme-config .island-grid:hover {
    border-color: rgba(255, 255, 255, 0.1);
    box-shadow: 0 0 50px rgba(255, 255, 255, 0.02);
    background: rgba(255, 255, 255, 0.01);
}


/* --- MOBILE (< 768px) --- */
/* Capacity: 6 units (2x3). All squares. */
@media (max-width: 767px) {
    .island-grid {
        /* FIX: 2 columns for simple grid */
        grid-template-columns: repeat(2, 1fr);
        /* FIX: 3 rows to fit 6 items perfectly in screen */
        grid-template-rows: repeat(3, 1fr);
        /* FIX: Reduced gap to 5px */
        gap: 5px;
        height: 100%; /* Fill container */

        /* FIX: Reset margin/padding on mobile */
        margin: 0;
        padding: 0;
        width: 100%;

        /* Disable hover effects on mobile */
        border: none;
        background: none !important;
        box-shadow: none !important;
    }

    /* ALL CARDS -> 1x1 SQUARE */
    .size-xl, .size-l, .size-m, .size-s {
        grid-column: span 1 !important;
        grid-row: span 1 !important;
    }
}

/* --- TABLET VERTICAL (768px - 1023px) --- */
/* Capacity: 96 units (8x12). Perfect inversion of Desktop (12x9 -> 108 vs 96). */
@media (min-width: 768px) and (max-width: 1023px) {
    .island-grid {
        /* FIX: 8 columns x 12 rows for perfect vertical adaptation */
        grid-template-columns: repeat(8, 1fr);
        grid-template-rows: repeat(12, 1fr);
        height: 100%;

        /* Tablet padding */
        margin: 0;
        padding: 0 10px;
    }

    /* 8x12 Logic */
    .size-xl { grid-column: span 8; grid-row: span 4; } /* Full width (8), Height 4 */
    .size-l  { grid-column: span 4; grid-row: span 4; } /* Half width (4), Height 4 (Square) */
    .size-m  { grid-column: span 4; grid-row: span 2; } /* Half width (4), Height 2 */
    .size-s  { grid-column: span 2; grid-row: span 2; } /* Quarter width (2), Height 2 */
}

/* --- DESKTOP & LAPTOP (1024px - 1920px) --- */
/* Capacity: 108 units (12x9). TALL GRID. */
/* XL=36, L=18, M=9, S=9 */
/* Set (1 XL, 3 L, 2 M): 36 + 54 + 18 = 108. PERFECT. */
@media (min-width: 1024px) {
    .island-grid {
        /* FIX: Force 4:3 aspect ratio to prevent stretching on 16:9 screens */
        /* height: 100%; <-- REMOVED here too, handled by base class flex-grow */
        /* width: auto; handled by base class */
        /* margin: 0 25px; handled by base class */

        grid-template-columns: repeat(12, 1fr);
        grid-template-rows: repeat(9, 1fr); /* 9 rows fixed */
    }

    /* XL: 6x6 = 36u (Square) */
    .size-xl { grid-column: span 6; grid-row: span 6; }

    /* L: 6x3 = 18u (Wide strip) */
    .size-l  { grid-column: span 6; grid-row: span 3; }

    /* M: 3x3 = 9u (Square) */
    .size-m  { grid-column: span 3; grid-row: span 3; }

    /* S: 3x3 = 9u (Same as M) */
    .size-s  { grid-column: span 3; grid-row: span 3; }
}

/* --- ULTRA WIDE (> 1921px) --- */
/* Capacity: 192 units (16x12). TALL GRID. */
/* XL=64, L=32, M=16, S=16 */
/* Set (1 XL, 3 L, 2 M): 64 + 96 + 32 = 192. PERFECT. */
@media (min-width: 1921px) {
    .island-grid {
        height: 100%;

        grid-template-columns: repeat(16, 1fr);
        grid-template-rows: repeat(12, 1fr); /* 12 rows fixed */
    }

    /* XL: 8x8 = 64u (Square) */
    .size-xl { grid-column: span 8; grid-row: span 8; }

    /* L: 8x4 = 32u (Wide strip) */
    .size-l  { grid-column: span 8; grid-row: span 4; }

    /* M: 4x4 = 16u (Square) */
    .size-m  { grid-column: span 4; grid-row: span 4; }

    /* S: 4x4 = 16u (Same as M) */
    .size-s  { grid-column: span 4; grid-row: span 4; }
}

/* Aliases for legacy support or explicit span control */
.col-span-3 { grid-column: span 3; }
.col-span-4 { grid-column: span 4; }
.col-span-6 { grid-column: span 6; }
.col-span-8 { grid-column: span 8; }
.col-span-12 { grid-column: span 12; }


/* ============================================
   2. BASE BENTO CARD (Visuals)
   ============================================ */
.bento-card {
    /* --- DEFAULT VARIABLES (Fallback: Ghost Theme) --- */
    /* Increased opacity for better contrast against dark background */
    --bento-bg: rgba(255, 255, 255, 0.03);
    --bento-border: rgba(255, 255, 255, 0.12);
    --bento-accent: var(--color-ghost);
    --bento-text-main: var(--color-ivory);
    --bento-text-sub: var(--color-ghost);
    --bento-glow: rgba(255, 255, 255, 0.05);

    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    /* FIX: Reduced padding to 10px as requested */
    padding: 10px;
    border-radius: 16px;
    overflow: hidden;
    isolation: isolate;

    background: var(--bento-bg);
    border: 1px solid var(--bento-border);
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);

    /* Subtle shadow for depth */
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);

    container-type: inline-size;
    container-name: bento;
    text-decoration: none;
}

.bento-card:hover {
    transform: translateY(-4px);
    background: rgba(35, 35, 55, 0.8); /* Darker on hover for pop */
    border-color: var(--bento-accent);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4), 0 0 0 1px var(--bento-accent-dim, rgba(255,255,255,0.05));
}

.bento-card:active { transform: translateY(-2px) scale(0.99); }

/* ============================================
   3. THEME VARIANTS (Visual)
   ============================================ */
.visual-theme-gold {
    --bento-accent: var(--color-gold);
    --bento-accent-dim: rgba(212, 175, 55, 0.3);
    --bento-bg: linear-gradient(135deg, rgba(212, 175, 55, 0.08) 0%, rgba(30, 30, 47, 0.6) 100%);
    border-left: 3px solid var(--bento-accent);
}

.visual-theme-blue {
    --bento-accent: var(--color-blue);
    --bento-accent-dim: rgba(48, 105, 152, 0.3);
    --bento-bg: rgba(30, 30, 47, 0.5);
    border-left: 3px solid var(--bento-accent);
}
.visual-theme-blue::before {
    content: '';
    position: absolute; inset: 0;
    background-image: linear-gradient(rgba(48, 105, 152, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(48, 105, 152, 0.1) 1px, transparent 1px);
    background-size: 30px 30px;
    opacity: 0.3;
    z-index: -1;
    pointer-events: none;
}

.visual-theme-green {
    --bento-accent: var(--color-green);
    --bento-accent-dim: rgba(39, 201, 63, 0.3);
    /* Explicit border override for dashed style */
    border: 1px dashed rgba(255, 255, 255, 0.3);
    border-left: 3px solid var(--bento-accent); /* Keep left accent */
}

.visual-theme-purple {
    --bento-accent: #c678dd;
    --bento-accent-dim: rgba(198, 120, 221, 0.3);
    border-left: 3px solid var(--bento-accent);
}

.visual-theme-ghost {
    --bento-accent: var(--color-ghost);
    --bento-accent-dim: rgba(255, 255, 255, 0.1);
    border-left: 3px solid var(--bento-accent);
    opacity: 0.8; /* Slightly faded */
}

/* ============================================
   4. INTERNAL ELEMENTS
   ============================================ */
.bento-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
    position: relative;
    z-index: 2;
}

.bento-type {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--bento-text-sub);
    transition: color 0.3s;
}
.bento-card:hover .bento-type { color: var(--bento-accent); }

.bento-status {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: var(--bento-text-sub);
    box-shadow: 0 0 5px rgba(255, 255, 255, 0.2);
}
.bento-status.active {
    background-color: var(--bento-accent);
    box-shadow: 0 0 8px var(--bento-accent-dim);
}

.bento-title {
    font-size: clamp(1rem, 4cqw, 1.4rem);
    font-weight: 800; /* Increased weight */
    color: var(--bento-text-main);
    margin-bottom: 8px;
    line-height: 1.2;
    transition: color 0.3s;
    position: relative;
    z-index: 2;
    font-family: 'JetBrains Mono', monospace; /* Explicit font */
    letter-spacing: -0.02em;
}
.bento-card:hover .bento-title { color: #ffffff; }

.bento-desc {
    font-family: 'Inter', sans-serif;
    font-size: 0.85rem;
    color: var(--bento-text-sub);
    line-height: 1.5;
    flex-grow: 1;
    position: relative;
    z-index: 2;
    opacity: 0.8; /* Better contrast hierarchy */

    /* Line Clamp for Desktop */
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* --- COMPACT LAPTOP OVERRIDES (1024px - 1440px) --- */
@media (min-width: 1024px) and (max-width: 1440px) {
    .bento-title {
        /* Reduce title size */
        font-size: clamp(0.9rem, 1.5cqw, 1.1rem);
        margin-bottom: 4px;
    }

    .bento-desc {
        /* Reduce description size */
        font-size: 0.75rem;
        -webkit-line-clamp: 3; /* Ensure clamping */
    }

    .bento-type {
        /* Reduce type label size */
        font-size: 0.6rem;
    }

    .bento-header {
        margin-bottom: 6px;
    }
}

/* --- TABLET & MOBILE OVERRIDES (< 1024px) --- */
@media (max-width: 1023px) {
    /* Smaller fonts */
    .bento-title {
        font-size: 0.9rem;
        margin-top: 4px;
        margin-bottom: 0;
    }

    .bento-type {
        font-size: 0.6rem;
        opacity: 0.7;
    }

    .bento-header {
        margin-bottom: 4px;
        width: 100%;
    }

    /* Tags aligned to right */
    .bento-tags {
        display: flex !important;
        justify-content: flex-end;
        width: 100%;
        margin-top: auto;
    }

    /* Allow text wrapping for description */
    .bento-desc {
        font-size: 0.75rem;
        -webkit-line-clamp: 4; /* Allow more lines if needed */
        margin-bottom: 5px;
    }
}

/* Mobile App Mode: Compact Cards (< 768px) */
@media (max-width: 767px) {
    /* Hide description and status to save space ONLY on mobile */
    .bento-desc { display: none !important; }
    .bento-status { display: none !important; }

    /* Compact Card Layout */
    .bento-card {
        /* FIX: Center content layout */
        display: flex;
        flex-direction: column;
        justify-content: center; /* Center vertically */
        align-items: center; /* Center horizontally */
        text-align: center;
        padding: 5px;
        position: relative; /* For absolute positioning of header/tags */
    }

    /* Header (Type) - Top Left */
    .bento-header {
        position: absolute;
        top: 5px;
        left: 5px;
        margin: 0;
        width: auto;
    }

    .bento-type {
        font-size: 0.5rem; /* Even smaller */
        opacity: 0.6;
    }

    /* Title - Center */
    .bento-title {
        font-size: 0.9rem; /* Slightly larger for emphasis */
        /* FIX: Auto margin to center vertically if needed, but justify-content handles it */
        margin: auto 0;
        width: 100%;
        padding: 0 5px; /* Prevent touching edges */
        z-index: 2;
    }

    /* Tags - Bottom Scroll Strip */
    .bento-tags {
        position: absolute;
        bottom: 5px;
        left: 0;
        width: 100%;

        display: flex !important;
        justify-content: flex-start !important; /* Start from left for scroll */
        flex-wrap: nowrap !important; /* No wrap */

        overflow-x: auto; /* Horizontal scroll */
        scrollbar-width: none; /* Hide scrollbar Firefox */
        -ms-overflow-style: none; /* Hide scrollbar IE */

        padding: 0 5px; /* Side padding */
        gap: 4px;

        /* Mask for fade effect on sides? Optional */
        mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
        -webkit-mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
    }

    .bento-tags::-webkit-scrollbar {
        display: none; /* Hide scrollbar Chrome/Safari */
    }

    /* Smaller tags on mobile */
    .bento-tag {
        font-size: 0.55rem;
        padding: 1px 4px;
        flex-shrink: 0; /* Don't shrink tags */
    }
}

/* --- LARGE MOBILE (425px - 767px) --- */
@media (min-width: 425px) and (max-width: 767px) {
    /* Restore standard layout logic */
    .bento-card {
        justify-content: space-between;
        align-items: flex-start;
        text-align: left;
    }

    /* Restore header position */
    .bento-header {
        position: relative;
        top: auto;
        left: auto;
        margin-bottom: 4px;
    }

    /* Restore tags position */
    .bento-tags {
        position: relative;
        bottom: auto;
        left: auto;
        overflow-x: visible;
        flex-wrap: wrap !important;
        justify-content: flex-end !important;
        padding: 0;
        mask-image: none;
        -webkit-mask-image: none;
    }

    /* Show description */
    .bento-desc {
        display: -webkit-box !important;
        -webkit-line-clamp: 2; /* Limit to 2 lines */
        font-size: 0.7rem;
        margin-top: 0;
        margin-bottom: 5px;
        opacity: 0.8;
    }

    /* Reset title */
    .bento-title {
        margin: 0 0 4px 0;
        width: auto;
        padding: 0;
    }
}
